## 大型网站的架构演变

[MySpace的五个里程碑](http://www.itivy.com/ivy/archive/2011/3/7/634351257301504864.html)

[Flickr的架构](http://www.itivy.com/ivy/archive/2011/3/7/634351294385186067.html)

[YouTube的架构](http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html)

[PlentyOfFish的架构](http://www.itivy.com/ivy/archive/2011/3/5/634349627089221280.html)

[WikiPedia的架构](http://www.itivy.com/ivy/archive/2011/3/7/634351127072679482.html)

## **架构演变第一步: 物理分离**

***\*WebServer\****

***\*数据库\**

**

## **架构演变第二步：增加页面缓存**

**

- ***\*访问数据库的操作太多\****

- **页面缓存层**

- - CDN

  - **squid**

  - - **来做相对静态的页面的缓存**
    - **如想用好的话还得深入掌握下squid的实现方式以及缓存的失效算法等**

  - Varnish

- 途径

- - 减少Http请求

  - 压缩css，js，图片的大小

  - 将Microsoft Ajax Minifier集成到VS2010对JS

  - - CSS进行编译时压缩

  - 增加页面缓存和增加数据缓存处理

  - cnblogs上的缓存全解析

  - 自购服务器进行IDC托管

  - 自购服务器能够提升硬件的档次以及带宽可以自由控制

  - - 一般都是独享带宽

    - - 相比共享带宽来说能够支撑更多的访问量         

## **架构演变第三步：增加页面片段缓存**

**

**采用ESI来做动态页面中相对静态的片段部分的缓存**

## **架构演变第四步：数据缓存**

**

- ***\*80% 的业务访问集中在20% 的数据上\****

- 缓存方式

- - 本地缓存
  - 远程缓存

- **缓存技术**  

- - **Map数据结构**
  - **缓存算法**
  - **所选用的框架本身的实现机制等**

## **架构演变第五步： 增加WebServer**

- **负载均衡层**

- - 最前端

  - - **F5** 
    - **LVS**  

  - **七层代理**

  - - **nginx**

  - **HAProxy**

- **如何保持状态信息的同步**

- - **用户session**

  - - **这个时候会考虑的方案**

    - - **写入数据库**
      - **写入存储**
      - **cookie**
      - **同步session信息等机制**

- **如何保持数据缓存信息的同步**

- - **例如之前缓存的用户数据等**

  - - **缓存同步**
    - **分布式缓存**

- **如何让上传文件这些类似的功能继续正常**

- - **共享文件系统**
  - **存储**

**
**

## **架构演变第六步：分库**

**

**数据库写入、更新的这些操作的部分数据库连接的资源竞争非常激烈

**

- **文件服务器层**

- - 单NFS+备份NFS作为文件服务器

  - - 维护方便
    - 单点故障
    - 需要人手动干预

  - DRBD+HeartBeat+NFS高可用文件服务器

  - - 维护方便
    - 不存在单点故障

  - 分布式文件系统MFS、Glustr

  - - MFS

    - - 易用、稳定、对海量小文件很高效
      - 而且新版的MFS解决了MasterServer存在单点故障的问题

    - 分布式文件系统是解决文件服务器压力过大的最终途径

    - - 但也存在隐患，网站功能越多，摊子越大，机器越多，维护起来越复杂

  - 自行研发的分布式文件系统

  - - TFS 淘宝&腾讯   

## **架构演变第七步：分表、DAL和分布式缓存**

**

**增加一个通用的框架来实现分库分表的数据访问，这个在ebay的架构中对应的就是DAL

**

**数据量太大，导致现在不太可能将缓存存在本地，然后同步的方式，需要采用分布式缓存方案

**


*## **架构演变第八步：增加更多的WebServer**

- Apache的软负载或LVS软负载等无法承担巨大的web访问量（请求连接数、网络流量等）的调度了

- - 这个时候如果经费允许的话

  - - 会采取的方案是购买硬件负载平衡设备

    - - F5
      - Netsclar
      - Athelon

  - 如经费不允许的话

  - - 会采取的方案是

    - - 将应用从逻辑上做一定的分类

      - - 然后分散到不同的软负载集群中

**原有的一些状态信息同步、文件共享等方案可能会出现瓶颈，需要进行改进，也许这个时候会根据情况编写符合网站业务需求的分布式文件系统等；

**

## **架构演变第九步：数据读写分离和廉价存储方案**

**

**发现数据库的读写比很高，这个时候通常会想到数据读写分离的方案

**

**NoSql数据库大量应用于微博系统等事务性不强的系统

**

**BigTableMongoDB**


## **架构演变第十步：进入大型分布式应用时代和廉价服务器群梦想时代**

**

- **拆成分布式后需要提供一个**

- - **高性能**

  - **稳定的通信框架**

  - - **并且需要支持多种不同的通信和远程调用方式**

- **将一个庞大的应用拆分需要耗费很长的时间，需要进行业务的整理和系统依赖关系的控制等；**

- **如何运维**

- - **依赖管理**
  - **运行状况管理**
  - **错误追踪**
  - **调优**
  - **监控**
  - **报警**
