
# Pre Install
yum -y install make gcc-c++ cmake bison-devel  ncurses-devel

# Install source code
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.17.tar.gz

tar xvf mysql-5.6.17.tar.gz
cd mysql-5.6.17

cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DSYSCONFDIR=/etc \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock \
-DMYSQL_TCP_PORT=3306 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DEXTRA_CHARSETS=all \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci

make && make install


# Deploy
groupadd mysql
useradd -g mysql mysql
chown -R mysql:mysql /usr/local/mysql

cd /usr/local/mysql
scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql

cp support-files/mysql.server /etc/init.d/mysql
chkconfig mysql on
service mysql start

# Deploy user
PATH=/usr/local/mysql/bin:$PATH
export PATH
source /etc/profile

mysql -uroot  
mysql> SET PASSWORD = PASSWORD('PASSWORD');

mysql> GRANT ALL PRIVILEGES ON *.* TO 'root'@'172.16.%' IDENTIFIED BY 'password' WITH GRANT OPTION;



# Firewall
vi /etc/sysconfig/iptables
-A INPUT m state --state NEW m tcp p dport 3306 j ACCEPT
service iptables restart





#-------------------------
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \ #安装路径
 
-DMYSQL_DATADIR=/usr/local/mysql/data \ #数据文件存放位置
 
-DSYSCONFDIR=/etc \ #my.cnf路径
 
-DWITH_MYISAM_STORAGE_ENGINE=1 \ #支持MyIASM引擎
 
-DWITH_INNOBASE_STORAGE_ENGINE=1 \ #支持InnoDB引擎
 
-DWITH_MEMORY_STORAGE_ENGINE=1 \ #支持Memory引擎
 
-DWITH_READLINE=1 \ #快捷键功能(我没用过)
 
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \ #连接数据库socket路径
 
-DMYSQL_TCP_PORT=3306 \ #端口
 
-DENABLED_LOCAL_INFILE=1 \ #允许从本地导入数据
 
-DWITH_PARTITION_STORAGE_ENGINE=1 \ #安装支持数据库分区
 
-DEXTRA_CHARSETS=all \ #安装所有的字符集
 
-DDEFAULT_CHARSET=utf8 \ #默认字符
 
-DDEFAULT_COLLATION=utf8_general_ci #默认校对规则
 
utf8_general_ci 不区分大小写
 
utf8_general_cs 区分大小写
#-------------------------



###DDL  pt-online-schema-change
https://www.percona.com/doc/percona-toolkit/2.1/pt-online-schema-change.html

yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-Digest-MD5 -y
perl Makefile.PL
make && make install

create database test;
CREATE TABLE `pt` (
 `id` int(11) NOT NULL DEFAULT '0',
 `disktype` enum('sas','shannon','memdisk') NOT NULL,
 `blocksize` enum('4K','64K','256K','1M') NOT NULL,
 `testmode` enum('seqwr','seqrewr','seqrd','rndrd','rndwr','rndrw') NOT NULL,
 `thread` enum('1','2','4','8','16','32') NOT NULL,
 `bandwidth` float(10,2) unsigned NOT NULL,
 `resptime` float(10,2) unsigned NOT NULL DEFAULT '0.00',
 PRIMARY KEY (`id`),
 UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
#修改字段
pt-online-schema-change --user=root --password=welcome --alter "CHANGE resptime responsetime float(10,2) unsigned not NULL default '0'" D=mytest,t='pt' --execute --print --statistics --no-check-alter

#增加列
pt-online-schema-change --user=root --password=welcome --alter "add p1 float(10,2) not NULL default '0'" D=test,t='pt' --execute --print --statistics --no-check-alter

#删除列
pt-online-schema-change --user=root --password=welcome --alter "drop p1" D=mytest,t='pt' --execute --print --statistics --no-check-alter














