
# Pre Install
yum -y install make gcc-c++ cmake bison-devel  ncurses-devel

# Install source code
wget http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.17.tar.gz

tar xvf mysql-5.6.17.tar.gz
cd mysql-5.6.17

cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DSYSCONFDIR=/etc \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock \
-DMYSQL_TCP_PORT=3306 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DEXTRA_CHARSETS=all \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci

make && make install


# Deploy
groupadd mysql
useradd -g mysql mysql
chown -R mysql:mysql /usr/local/mysql

cd /usr/local/mysql
scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql

cp support-files/mysql.server /etc/init.d/mysql
chkconfig mysql on
service mysql start

# Deploy user
PATH=/usr/local/mysql/bin:$PATH
export PATH
source /etc/profile

mysql -uroot  
mysql> SET PASSWORD = PASSWORD('PASSWORD');

mysql> GRANT ALL PRIVILEGES ON *.* TO 'root'@'172.16.%' IDENTIFIED BY 'password' WITH GRANT OPTION;



# Firewall
vi /etc/sysconfig/iptables
-A INPUT m state --state NEW m tcp p dport 3306 j ACCEPT
service iptables restart





#-------------------------
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \ #安装路径
 
-DMYSQL_DATADIR=/usr/local/mysql/data \ #数据文件存放位置
 
-DSYSCONFDIR=/etc \ #my.cnf路径
 
-DWITH_MYISAM_STORAGE_ENGINE=1 \ #支持MyIASM引擎
 
-DWITH_INNOBASE_STORAGE_ENGINE=1 \ #支持InnoDB引擎
 
-DWITH_MEMORY_STORAGE_ENGINE=1 \ #支持Memory引擎
 
-DWITH_READLINE=1 \ #快捷键功能(我没用过)
 
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \ #连接数据库socket路径
 
-DMYSQL_TCP_PORT=3306 \ #端口
 
-DENABLED_LOCAL_INFILE=1 \ #允许从本地导入数据
 
-DWITH_PARTITION_STORAGE_ENGINE=1 \ #安装支持数据库分区
 
-DEXTRA_CHARSETS=all \ #安装所有的字符集
 
-DDEFAULT_CHARSET=utf8 \ #默认字符
 
-DDEFAULT_COLLATION=utf8_general_ci #默认校对规则
 
utf8_general_ci 不区分大小写
 
utf8_general_cs 区分大小写
#-------------------------



###DDL  pt-online-schema-change
https://www.percona.com/doc/percona-toolkit/2.1/pt-online-schema-change.html

yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-Digest-MD5 -y
perl Makefile.PL
make && make install

create database test;
CREATE TABLE `pt` (
 `id` int(11) NOT NULL DEFAULT '0',
 `disktype` enum('sas','shannon','memdisk') NOT NULL,
 `blocksize` enum('4K','64K','256K','1M') NOT NULL,
 `testmode` enum('seqwr','seqrewr','seqrd','rndrd','rndwr','rndrw') NOT NULL,
 `thread` enum('1','2','4','8','16','32') NOT NULL,
 `bandwidth` float(10,2) unsigned NOT NULL,
 `resptime` float(10,2) unsigned NOT NULL DEFAULT '0.00',
 PRIMARY KEY (`id`),
 UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
#修改字段
pt-online-schema-change --user=root --password=welcome --alter "CHANGE resptime responsetime float(10,2) unsigned not NULL default '0'" D=mytest,t='pt' --execute --print --statistics --no-check-alter

#增加列
pt-online-schema-change --user=root --password=welcome --alter "add p1 float(10,2) not NULL default '0'" D=test,t='pt' --execute --print --statistics --no-check-alter

#删除列
pt-online-schema-change --user=root --password=welcome --alter "drop p1" D=mytest,t='pt' --execute --print --statistics --no-check-alter


##monitor
# per sec operate
show global status where Variable_name in('com_select','com_insert','com_delete','com_update');

# qps 每秒处理的查询数
  tps 每秒处理的事务数
  IOPS，每秒磁盘进行的I/O操作次数

QPS (Query per second) （每秒查询量）
TPS(Transaction per second) （每秒事务量，如果是InnoDB会显示，没有InnoDB就不会显示）

QPS
Questions = SHOW GLOBAL STATUS LIKE 'Questions';
Uptime = SHOW GLOBAL STATUS LIKE 'Uptime';
QPS=Questions/Uptime
TPS
Com_commit = SHOW GLOBAL STATUS LIKE 'Com_commit';
Com_rollback = SHOW GLOBAL STATUS LIKE 'Com_rollback';
Uptime = SHOW GLOBAL STATUS LIKE 'Uptime';
TPS=(Com_commit + Com_rollback)/Uptime




#check
show engine innodb status\G;




##windows zip mode
#get
https://dev.mysql.com/downloads/mysql/


#set

mkdir d:\mysql\data 
设置环境变量，鼠标选中“计算机” >>然后点击鼠标右键，选择属性>>“高级系统设置”>>“环境变量”
新建一个环境变量MYSQL_HOME，他的值为D:\mysql
还要在PATH路径上添加Mysql的bin目录，也就是D:\mysql\bin

 d:/mysql/my.ini
[mysqld]

#设置3306端口
port=3306

#设置mysql的安装目录
basedir=D:\\mysql

# 切记此处一定要用双斜杠\\，单斜杠我这里会出错。
#设置mysql数据库的数据的存放目录
datadir=D:\\mysql\\data  

# 此处同上#允许最大连接数
max_connections=200

#允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统
max_connect_errors=10

#服务端使用的字符集默认为UTF8
character-set-server=utf8

#创建新表时将使用的默认存储引擎
default-storage-engine=INNODB

#默认使用“mysql_native_password”插件认证
default_authentication_plugin=mysql_native_password

[mysql]
#设置mysql客户端默认字符集
default-character-set=utf8

[client]
#设置mysql客户端连接服务端时默认使用的端口
port=3306
default-character-set=utf8









#run 
cd d:/mysql/bin

# 获取临时密码
mysqld --initialize --console

# 服务部署
mysqld --install 

net start mysql

# 修改临时密码
mysql -uroot -p
ALTER USER 'root'@'localhost' IDENTIFIED BY 'password';
show databases;



#test
mysqlshow -uroot -p$pwd


#more
case:找不到msvcp140.dll
安装Microsoft Visual C++ 2015 Redistributable
https://www.microsoft.com/en-us/download/details.aspx?id=53587




