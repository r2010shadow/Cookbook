# 何为file
```
Linux文件系统中的文件是数据的集合，文件系统不仅包含着文件中的数据而且还有文件系统的结构，
所有Linux 用户和程序看到的文件、目录、软连接及文件保护信息等都存储在其中。

在Linux中普通文件和目录文件保存在称为块物理设备的磁盘或者磁带上。
一套Linux系统支持若干物理盘，每个物理盘可定义一个或者多个文件系统。（类比于微机磁盘分区）。
每个文件系统由逻辑块的序列组成，一个逻辑盘空间一般划分为几个用途各不相同的部分，即引导块、超级块、inode区以及数据区等。
```
<img src="https://github.com/r2010shadow/Cookbook/blob/master/Linux/img/linux_file.jpg" width=600 alt="linux_file">


# 文件类型
* 普通文件 ( regular file )
```
最常用的文件类型，包含了某种形式的数据。至于这种数据是文本还是二进制数据，对于 Linux 内核而言并无区别。
文件中包含的字节可以是任意值，可以以任意方式进行组织。在系统层，除了字节流，Linux 对文件结构没有特定要求。
对普通文件内容的解释由处理该文件的应用程序进行。
文件虽然是通过文件名访问，但文件本身其实并没有直接和文件名关联。相反地，与文件关联的是索引节点 (inode，是index node 缩写)。针对驻留于文件系统上的每个文件，文件系统都会为其分配一个 inode。inode 中会保存和文件相关的元数据，如文件修改时间戳、所有者、类型、长度以及文件数据的位置，但不含文件名，文件名由目录文件负责。
inode 由 inode number 来标识，可以通过 “ls –li” 查看文件的 inode number。
# ls -li minicom.log
12582945 -rw-r--r-- 1 root root 665 Jul 10 18:47 minicom.log
```

* 目录文件 ( directory file )
```
目录也是一种文件类型，这种文件包含了其他文件的文件名以及 inode number。文件通常是通过文件名从用户空间打开，目录用于提供访问文件时需要的名称。
文件名和 inode 之间的配对称为链接 (link)。映射在物理磁盘上的形式，如简单的表或散列，是通过特定文件系统的内核代码来实现和管理的。
如果用户空间的应用请求打开指定文件，内核会打开包含该文件名的目录，然后根据文件名获取 inode number。通过 inode number 可以找到 inode。inode 包含和文件关联的元数据，其中包括文件数据在磁盘上的存储位置。
```

* 硬链接 ( hard link )
```
不同的文件名可以链接到到同一个 inode。当不同名称的多个链接映射到同一个索引节点时，我们称该链接为硬链接。
硬链接通常要求链接和文件位于同一文件系统中。
在底层文件系统支持的前提下，也只有超级用户才能创建指向目录的硬链接。
```


* 符号链接 ( symbolic link )
```
符号链接是对一个文件的间接指针，它与硬链接有所不同，硬链接直接指向文件的 inode。引入符号链接的原因是为了避开硬链接的一些限制。
硬链接不能跨越多个文件系统，因为 inode number在自己的文件系统之外没有任何意义。为了跨越文件系统建立链接，Linux 系统实现了符号链接。
```

* 特殊文件 (special file)
```
特殊文件是使得某些抽象可以适用于文件系统，贯彻一切皆文件的理念。
Linux 只支持四种特殊文件：块设备文件、字符设备文件、命名管道 以及 UNIX域套接字。
块特殊文件 ( block device file )。提供对设备（如磁盘）带缓冲的访问，每次访问以固定长度为单位进行。
字符特殊文件 ( character device file )。这种类型的文件提供对设备不带缓冲的访问，每次访问长度可变。系统中的所有设备要么是字符特殊文件，要么是块特殊文件。
命名管道 ( named pipes )，通常称为 FIFO，是以文件描述符作为通信信道的 IPC 机制，它可以通过特殊文件来访问。
套接字 ( socket ) 是最后一种特殊文件。socket 是进程间通信的高级形式，支持不同进程间的通信，这两个进程可以在同一台机器，也可以在不同机器。socket 是网络和互联网编程的基础。
```
## 查看文件类型
```
在 Linux，可以用 ls/stat 命令 和 stat() 系统调用确定文件类型。

$ ls -li 
12587634 drwxr-xr-x 26 root root      4096 Mar 16 07:49 1.opensource
27396428 lrwxrwxrwx  1 root root        12 Nov 17  2017 Link to ssd_dvd -> /mnt/ssd_dvd
12582945 -rw-r--r--  1 root root       665 Jul 10 18:47 minicom.log

$ stat minicom.log 
  File: 'minicom.log'
  Size: 665        Blocks: 8          IO Block: 4096   regular file
Device: 822h/2082d Inode: 12582945    Links: 1
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2020-01-09 09:44:07.101177618 +0800
Modify: 2020-07-10 18:47:20.073532673 +0800
Change: 2020-07-10 18:47:20.073532673 +0800
```

# 文件描述符
```
在 Linux 中，文件必须先打开才能访问。对于内核而言，所有打开的文件都通过文件描述符 ( file descriptor，简称fd ) 引用。
文件描述符是一个非负整数。当打开一个现有文件或创建一个新文件时，内核向进程返回一个文件描述符。
当读、写一个文件时，使用 open() 或 creat() 返回的文件描述符标识该文件，将其作为参数传送给 read() 或 write()。
```
* Linux 系统编程的大部分工作都会涉及打开、操纵、关闭以及其他文件描述符操作;
* 文件描述符1、2、3
```
Linux 系统的 Shell 把
文件描述符 0 与进程的标准输入 stdin 关联，
文件描述符 1 与进程的标准输出 stdout 关联，
文件描述符 2 与进程的标准错误 stderr 关联。
这是各种 Shell 以及很多应用程序使用的惯例，与 Linux 内核无关。如果不遵循这种惯例，很多 Linux 系统应用程序就不能正常工作;
```
* 用户可以重定向文件描述符，甚至可以通过管道把一个程序的输出作为另一个程序的输入。Shell 就是通过这种方式实现重定向和管道的。
* 在 POSIX 标准中，幻数 0、1、2 虽然已被标准化，但应当把它们替换成符号常量 STDIN_FILENO、STDOUT_FILENO 和 STDERR_FILENO 以提高可读性;
* 文件描述符的范围是 0 ~ OPEN_MAX-1;
* 文件描述符并非局限于访问普通文件。实际上，文件描述符也可以访问设备文件、管道、FIFO、Socket等。遵循一切皆文件的理念，几乎任何能够读写的东西都可以通过文件描述符来访问。








